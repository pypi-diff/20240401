# Comparing `tmp/gaea_paddleclas-2.5.0-py3-none-any.whl.zip` & `tmp/gaea_paddleclas-2.5.0.1-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,12 +1,12 @@
-Zip file size: 498143 bytes, number of entries: 247
+Zip file size: 498568 bytes, number of entries: 247
 -rw-r--r--  2.0 unx    11357 b- defN 24-Mar-28 16:04 paddleclas/LICENSE
 -rw-r--r--  2.0 unx      317 b- defN 24-Mar-28 16:04 paddleclas/MANIFEST.in
 -rw-r--r--  2.0 unx    14081 b- defN 24-Mar-28 16:04 paddleclas/README.md
--rw-r--r--  2.0 unx      706 b- defN 24-Mar-28 16:04 paddleclas/__init__.py
+-rw-r--r--  2.0 unx      808 b- defN 24-Mar-29 08:51 paddleclas/__init__.py
 -rw-r--r--  2.0 unx    28095 b- defN 24-Mar-28 16:05 paddleclas/hubconf.py
 -rw-r--r--  2.0 unx    33108 b- defN 24-Mar-28 16:05 paddleclas/paddleclas.py
 -rw-r--r--  2.0 unx      756 b- defN 24-Mar-28 16:04 paddleclas/deploy/configs/inference_attr.yaml
 -rw-r--r--  2.0 unx     1592 b- defN 24-Mar-28 16:04 paddleclas/deploy/configs/inference_cartoon.yaml
 -rw-r--r--  2.0 unx      757 b- defN 24-Mar-28 16:04 paddleclas/deploy/configs/inference_cls.yaml
 -rw-r--r--  2.0 unx      749 b- defN 24-Mar-28 16:04 paddleclas/deploy/configs/inference_cls_based_action.yaml
 -rw-r--r--  2.0 unx      757 b- defN 24-Mar-28 16:04 paddleclas/deploy/configs/inference_cls_ch4.yaml
@@ -40,20 +40,20 @@
 -rw-r--r--  2.0 unx      122 b- defN 24-Mar-28 16:04 paddleclas/deploy/utils/__init__.py
 -rw-r--r--  2.0 unx     5865 b- defN 24-Mar-28 16:04 paddleclas/deploy/utils/config.py
 -rw-r--r--  2.0 unx     2044 b- defN 24-Mar-28 16:04 paddleclas/deploy/utils/draw_bbox.py
 -rw-r--r--  2.0 unx     1060 b- defN 24-Mar-28 16:04 paddleclas/deploy/utils/encode_decode.py
 -rw-r--r--  2.0 unx     1827 b- defN 24-Mar-28 16:04 paddleclas/deploy/utils/get_image_list.py
 -rw-r--r--  2.0 unx     3587 b- defN 24-Mar-28 16:04 paddleclas/deploy/utils/logger.py
 -rw-r--r--  2.0 unx     4866 b- defN 24-Mar-28 16:04 paddleclas/deploy/utils/predictor.py
--rw-r--r--  2.0 unx    14305 b- defN 24-Mar-29 02:47 paddleclas/gaea_paddleclas.egg-info/PKG-INFO
--rw-r--r--  2.0 unx     8798 b- defN 24-Mar-29 02:47 paddleclas/gaea_paddleclas.egg-info/SOURCES.txt
--rw-r--r--  2.0 unx        1 b- defN 24-Mar-29 02:47 paddleclas/gaea_paddleclas.egg-info/dependency_links.txt
--rw-r--r--  2.0 unx       58 b- defN 24-Mar-29 02:47 paddleclas/gaea_paddleclas.egg-info/entry_points.txt
--rw-r--r--  2.0 unx      137 b- defN 24-Mar-29 02:47 paddleclas/gaea_paddleclas.egg-info/requires.txt
--rw-r--r--  2.0 unx       11 b- defN 24-Mar-29 02:47 paddleclas/gaea_paddleclas.egg-info/top_level.txt
+-rw-r--r--  2.0 unx    14307 b- defN 24-Apr-01 11:36 paddleclas/gaea_paddleclas.egg-info/PKG-INFO
+-rw-r--r--  2.0 unx     8798 b- defN 24-Apr-01 11:36 paddleclas/gaea_paddleclas.egg-info/SOURCES.txt
+-rw-r--r--  2.0 unx        1 b- defN 24-Apr-01 11:36 paddleclas/gaea_paddleclas.egg-info/dependency_links.txt
+-rw-r--r--  2.0 unx       58 b- defN 24-Apr-01 11:36 paddleclas/gaea_paddleclas.egg-info/entry_points.txt
+-rw-r--r--  2.0 unx      137 b- defN 24-Apr-01 11:36 paddleclas/gaea_paddleclas.egg-info/requires.txt
+-rw-r--r--  2.0 unx       11 b- defN 24-Apr-01 11:36 paddleclas/gaea_paddleclas.egg-info/top_level.txt
 -rw-r--r--  2.0 unx      722 b- defN 24-Mar-28 16:05 paddleclas/ppcls/__init__.py
 -rw-r--r--  2.0 unx     5770 b- defN 24-Mar-28 16:05 paddleclas/ppcls/arch/__init__.py
 -rw-r--r--  2.0 unx     3640 b- defN 24-Mar-28 16:05 paddleclas/ppcls/arch/utils.py
 -rw-r--r--  2.0 unx     7210 b- defN 24-Mar-28 16:05 paddleclas/ppcls/arch/backbone/__init__.py
 -rw-r--r--  2.0 unx        0 b- defN 24-Mar-28 16:05 paddleclas/ppcls/arch/backbone/base/__init__.py
 -rw-r--r--  2.0 unx    12709 b- defN 24-Mar-28 16:05 paddleclas/ppcls/arch/backbone/base/theseus_layer.py
 -rw-r--r--  2.0 unx      694 b- defN 24-Mar-28 16:05 paddleclas/ppcls/arch/backbone/legendary_models/__init__.py
@@ -166,21 +166,21 @@
 -rw-r--r--  2.0 unx    25408 b- defN 24-Mar-28 16:05 paddleclas/ppcls/data/preprocess/ops/operators.py
 -rw-r--r--  2.0 unx     4529 b- defN 24-Mar-28 16:05 paddleclas/ppcls/data/preprocess/ops/randaugment.py
 -rw-r--r--  2.0 unx     4070 b- defN 24-Mar-28 16:05 paddleclas/ppcls/data/preprocess/ops/random_erasing.py
 -rw-r--r--  2.0 unx    31557 b- defN 24-Mar-28 16:05 paddleclas/ppcls/data/preprocess/ops/timm_autoaugment.py
 -rw-r--r--  2.0 unx      609 b- defN 24-Mar-28 16:05 paddleclas/ppcls/data/utils/__init__.py
 -rw-r--r--  2.0 unx     1827 b- defN 24-Mar-28 16:05 paddleclas/ppcls/data/utils/get_image_list.py
 -rw-r--r--  2.0 unx        0 b- defN 24-Mar-28 16:05 paddleclas/ppcls/engine/__init__.py
--rw-r--r--  2.0 unx    27916 b- defN 24-Mar-28 16:05 paddleclas/ppcls/engine/engine.py
+-rw-r--r--  2.0 unx    28887 b- defN 24-Apr-01 09:30 paddleclas/ppcls/engine/engine.py
 -rw-r--r--  2.0 unx      799 b- defN 24-Mar-28 16:05 paddleclas/ppcls/engine/evaluation/__init__.py
 -rw-r--r--  2.0 unx    10431 b- defN 24-Mar-28 16:05 paddleclas/ppcls/engine/evaluation/adaface.py
--rw-r--r--  2.0 unx    11473 b- defN 24-Mar-28 16:05 paddleclas/ppcls/engine/evaluation/classification.py
+-rw-r--r--  2.0 unx    11768 b- defN 24-Apr-01 09:30 paddleclas/ppcls/engine/evaluation/classification.py
 -rw-r--r--  2.0 unx    14462 b- defN 24-Mar-28 16:05 paddleclas/ppcls/engine/evaluation/retrieval.py
 -rw-r--r--  2.0 unx      659 b- defN 24-Mar-28 16:05 paddleclas/ppcls/engine/train/__init__.py
--rw-r--r--  2.0 unx     4921 b- defN 24-Mar-28 16:05 paddleclas/ppcls/engine/train/train.py
+-rw-r--r--  2.0 unx     5130 b- defN 24-Apr-01 09:30 paddleclas/ppcls/engine/train/train.py
 -rw-r--r--  2.0 unx     2986 b- defN 24-Mar-28 16:05 paddleclas/ppcls/engine/train/utils.py
 -rw-r--r--  2.0 unx     2965 b- defN 24-Mar-28 16:05 paddleclas/ppcls/loss/__init__.py
 -rw-r--r--  2.0 unx     4270 b- defN 24-Mar-28 16:05 paddleclas/ppcls/loss/afdloss.py
 -rw-r--r--  2.0 unx     2213 b- defN 24-Mar-28 16:05 paddleclas/ppcls/loss/celoss.py
 -rw-r--r--  2.0 unx     3297 b- defN 24-Mar-28 16:05 paddleclas/ppcls/loss/centerloss.py
 -rw-r--r--  2.0 unx     1497 b- defN 24-Mar-28 16:05 paddleclas/ppcls/loss/comfunc.py
 -rw-r--r--  2.0 unx     5632 b- defN 24-Mar-28 16:05 paddleclas/ppcls/loss/deephashloss.py
@@ -235,15 +235,15 @@
 -rw-r--r--  2.0 unx    19537 b- defN 24-Mar-28 16:05 paddleclas/ppcls/utils/feature_maps_visualization/resnet.py
 -rw-r--r--  2.0 unx     2635 b- defN 24-Mar-28 16:05 paddleclas/ppcls/utils/feature_maps_visualization/utils.py
 -rw-r--r--  2.0 unx      630 b- defN 24-Mar-28 16:05 paddleclas/tools/__init__.py
 -rw-r--r--  2.0 unx     1136 b- defN 24-Mar-28 16:05 paddleclas/tools/eval.py
 -rw-r--r--  2.0 unx     1602 b- defN 24-Mar-28 16:05 paddleclas/tools/export_model.py
 -rw-r--r--  2.0 unx     1138 b- defN 24-Mar-28 16:05 paddleclas/tools/infer.py
 -rw-r--r--  2.0 unx     5289 b- defN 24-Mar-28 16:05 paddleclas/tools/search_strategy.py
--rw-r--r--  2.0 unx     1190 b- defN 24-Mar-28 16:05 paddleclas/tools/train.py
--rw-r--r--  2.0 unx    11357 b- defN 24-Mar-29 02:47 gaea_paddleclas-2.5.0.dist-info/LICENSE
--rw-r--r--  2.0 unx    14320 b- defN 24-Mar-29 02:47 gaea_paddleclas-2.5.0.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 24-Mar-29 02:47 gaea_paddleclas-2.5.0.dist-info/WHEEL
--rw-r--r--  2.0 unx       58 b- defN 24-Mar-29 02:47 gaea_paddleclas-2.5.0.dist-info/entry_points.txt
--rw-r--r--  2.0 unx       11 b- defN 24-Mar-29 02:47 gaea_paddleclas-2.5.0.dist-info/top_level.txt
-?rw-rw-r--  2.0 unx    25468 b- defN 24-Mar-29 02:47 gaea_paddleclas-2.5.0.dist-info/RECORD
-247 files, 1725172 bytes uncompressed, 456455 bytes compressed:  73.5%
+-rw-r--r--  2.0 unx     1256 b- defN 24-Mar-29 08:36 paddleclas/tools/train.py
+-rw-r--r--  2.0 unx    11357 b- defN 24-Apr-01 11:36 gaea_paddleclas-2.5.0.1.dist-info/LICENSE
+-rw-r--r--  2.0 unx    14322 b- defN 24-Apr-01 11:36 gaea_paddleclas-2.5.0.1.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 24-Apr-01 11:36 gaea_paddleclas-2.5.0.1.dist-info/WHEEL
+-rw-r--r--  2.0 unx       58 b- defN 24-Apr-01 11:36 gaea_paddleclas-2.5.0.1.dist-info/entry_points.txt
+-rw-r--r--  2.0 unx       11 b- defN 24-Apr-01 11:36 gaea_paddleclas-2.5.0.1.dist-info/top_level.txt
+?rw-rw-r--  2.0 unx    25480 b- defN 24-Apr-01 11:36 gaea_paddleclas-2.5.0.1.dist-info/RECORD
+247 files, 1726831 bytes uncompressed, 456856 bytes compressed:  73.5%
```

## zipnote {}

```diff
@@ -717,26 +717,26 @@
 
 Filename: paddleclas/tools/search_strategy.py
 Comment: 
 
 Filename: paddleclas/tools/train.py
 Comment: 
 
-Filename: gaea_paddleclas-2.5.0.dist-info/LICENSE
+Filename: gaea_paddleclas-2.5.0.1.dist-info/LICENSE
 Comment: 
 
-Filename: gaea_paddleclas-2.5.0.dist-info/METADATA
+Filename: gaea_paddleclas-2.5.0.1.dist-info/METADATA
 Comment: 
 
-Filename: gaea_paddleclas-2.5.0.dist-info/WHEEL
+Filename: gaea_paddleclas-2.5.0.1.dist-info/WHEEL
 Comment: 
 
-Filename: gaea_paddleclas-2.5.0.dist-info/entry_points.txt
+Filename: gaea_paddleclas-2.5.0.1.dist-info/entry_points.txt
 Comment: 
 
-Filename: gaea_paddleclas-2.5.0.dist-info/top_level.txt
+Filename: gaea_paddleclas-2.5.0.1.dist-info/top_level.txt
 Comment: 
 
-Filename: gaea_paddleclas-2.5.0.dist-info/RECORD
+Filename: gaea_paddleclas-2.5.0.1.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## paddleclas/__init__.py

```diff
@@ -7,11 +7,15 @@
 #     http://www.apache.org/licenses/LICENSE-2.0
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
+import os
+__dir__ = os.path.dirname(os.path.abspath(__file__))
+import sys
+sys.path.insert(0, __dir__)
 
 __all__ = ['PaddleClas']
 from .paddleclas import PaddleClas
 from .ppcls.arch.backbone import *
```

## paddleclas/gaea_paddleclas.egg-info/PKG-INFO

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: gaea-paddleclas
-Version: 2.5.0
+Version: 2.5.0.1
 Summary: A treasure chest for visual recognition powered by PaddlePaddle.
 Home-page: https://github.com/PaddlePaddle/PaddleClas
 Download-URL: https://github.com/PaddlePaddle/PaddleClas.git
 License: Apache License 2.0
 Keywords: image-classification,image-recognition,pretrained-models,knowledge-distillation,product-recognition,autoaugment,cutmix,randaugment,gridmask,deit,repvgg,swin-transformer,image-retrieval-system
 Classifier: Development Status :: 5 - Production/Stable
 Classifier: Operating System :: OS Independent
```

## paddleclas/ppcls/engine/engine.py

```diff
@@ -67,17 +67,17 @@
             assert isinstance(seed, int), "The 'seed' must be a integer!"
             paddle.seed(seed)
             np.random.seed(seed)
             random.seed(seed)
 
         # init logger
         self.output_dir = os.path.abspath(self.config['Global']['output_dir'])
-        # log_file = os.path.join(self.output_dir, self.config["Arch"]["name"],
-        #                         f"{mode}.log")
-        # init_logger(log_file=log_file)
+        log_file = os.path.join(self.output_dir, self.config["Arch"]["name"],
+                                f"{mode}.log")
+        init_logger(log_file=log_file)
         print_config(config)
 
         # init train_func and eval_func
         assert self.eval_mode in [
             "classification", "retrieval", "adaface"
         ], logger.error("Invalid eval mode: {}".format(self.eval_mode))
         self.train_epoch_func = train_epoch
@@ -320,14 +320,35 @@
                         
         if not os.path.exists(self.work_dir):
             os.makedirs(self.work_dir)
         self.run_id = os.environ.get('WINDMILL_EXPERIMENT_RUN_ID', '100')
         self.best_schema_metric = None
         self.best_acc = 0.
 
+        # parse labels name info
+        import json
+        if self.mode == "train":
+            data_txt_path = self.config["DataLoader"]["Train"]["dataset"]["cls_label_path"]
+        elif self.mode == "eval":
+            data_txt_path = self.config["DataLoader"]["Eval"]["dataset"]["cls_label_path"]
+        elif self.mode == "test":
+            data_txt_path = self.config["DataLoader"]["Test"]["dataset"]["cls_label_path"]
+        else:
+            data_txt_path = None
+
+        if data_txt_path is not None:
+            labels_json_path = os.path.join(os.path.dirname(data_txt_path), "labels.json")
+            if os.path.exists(labels_json_path):
+                with open(labels_json_path, "r", encoding='utf-8') as f:
+                    self.label_name = json.load(f)
+        else:
+            self.label_name = []
+            
+        logger.info("label_name: {}".format(self.label_name))
+
     def train(self):
         assert self.mode == "train"
         print_batch_step = self.config['Global']['print_batch_step']
         save_interval = self.config["Global"]["save_interval"]
         best_metric = {
             "metric": -1.0,
             "epoch": 0,
@@ -455,24 +476,24 @@
 
         if self.vdl_writer is not None:
             self.vdl_writer.close()
 
         if self.best_schema_metric is not None:
             import json
             import fcntl
-            with open(os.path.join(self.work_dir, "metric.json"), 'w') as f:
+            with open(os.path.join(self.work_dir, "metric.json"), 'w', encoding='utf-8') as f:
                 try:
                     fcntl.flock(f, fcntl.LOCK_EX)
-                    json.dump(self.best_schema_metric, f, indent=2)
+                    json.dump(self.best_schema_metric, f, indent=2, ensure_ascii=False)
                 finally:
                     fcntl.flock(f, fcntl.LOCK_UN)
-            with open(os.path.join(self.output_dir, "metric.json"), 'w') as f:
+            with open(os.path.join(self.output_dir, "metric.json"), 'w', encoding='utf-8') as f:
                 try:
                     fcntl.flock(f, fcntl.LOCK_EX)
-                    json.dump(self.best_schema_metric, f, indent=2)
+                    json.dump(self.best_schema_metric, f, indent=2, ensure_ascii=False)
                 finally:
                     fcntl.flock(f, fcntl.LOCK_UN)
             logger.info("Save best eval metric.json to {} and {}".format(self.output_dir, self.work_dir))
 
     @paddle.no_grad()
     def eval(self, epoch_id=0):
         assert self.mode in ["train", "eval"]
```

## paddleclas/ppcls/engine/evaluation/classification.py

```diff
@@ -194,15 +194,15 @@
                     json.dump(train_schema_metric.dict(), f, indent=2)
                 finally:
                     fcntl.flock(f, fcntl.LOCK_UN)
             logger.info(f"Save training eval metric {engine.run_id}.json to {engine.work_dir}")
         except:
             logger.error(f"Failed to save training eval {engine.run_id}.json to {engine.work_dir}")
 
-    class_schema_metric = ImageClassificationMetric(labels=[], metrics=[])
+    class_schema_metric = ImageClassificationMetric(labels=engine.label_name, metrics=[])
     precision = precision_score(all_labels, all_pred_classes, average=None) # all classes
     recall = recall_score(all_labels, all_pred_classes, average=None)
     cm = confusion_matrix(all_labels, all_pred_classes)
 
     # 1. accuracy
     class_schema_metric.metrics.append(AccuracyMetric(name='accuracy',
                                                         displayName='Acc',
@@ -213,36 +213,39 @@
     prec_schema = LabelPrecisionMetric(name='labelPrecision', displayName='Category Precision',
                                         result=[])
 
     # 3. confusion matrix
     cm_schema = ConfusionMatrixMetric(name='confusionMatrix', displayName='混淆矩阵',
                     result=ConfusionMatrixMetricResult(annotationSpecs=[], rows=[]))  
     for i in range(class_num):
-        prec_schema.result.append(LabelPrecisionMetricResult(precision=precision[i], recall=recall[i]))
-        cm_schema.result.annotationSpecs.append(ConfusionMatrixAnnotationSpec(id=i))
+        label_name = engine.label_name[i]['name'] if len(engine.label_name) else None
+        prec_schema.result.append(LabelPrecisionMetricResult(
+                                    labelName=label_name, 
+                                    precision=precision[i], recall=recall[i]))
+        cm_schema.result.annotationSpecs.append(ConfusionMatrixAnnotationSpec(id=i, labelName=label_name))
         cm_schema.result.rows.append(ConfusionMatrixRow(row=cm[i].tolist()))
 
     class_schema_metric.metrics.append(prec_schema)
     class_schema_metric.metrics.append(cm_schema)
 
     if accuracy > engine.best_acc:
         engine.best_schema_metric = class_schema_metric.dict()
     
     if engine.mode == 'eval':
-        with open(os.path.join(engine.work_dir, "metric.json"), 'w') as f:
+        with open(os.path.join(engine.work_dir, "metric.json"), 'w', encoding='utf-8') as f:
             try:
                 fcntl.flock(f, fcntl.LOCK_EX)
-                json.dump(class_schema_metric.dict(), f, indent=2)
+                json.dump(class_schema_metric.dict(), f, indent=2, ensure_ascii=False)
             finally:
                 fcntl.flock(f, fcntl.LOCK_UN)
             
-        with open(os.path.join(engine.output_dir, "metric.json"), 'w') as f:
+        with open(os.path.join(engine.output_dir, "metric.json"), 'w', encoding='utf-8') as f:
             try:
                 fcntl.flock(f, fcntl.LOCK_EX)
-                json.dump(class_schema_metric.dict(), f, indent=2)
+                json.dump(class_schema_metric.dict(), f, indent=2, ensure_ascii=False)
             finally:
                 fcntl.flock(f, fcntl.LOCK_UN)
         logger.info("Save eval metric.json to {} and {}".format(engine.output_dir, engine.work_dir))
         
     if engine.use_dali:
         engine.eval_dataloader.reset()
```

## paddleclas/ppcls/engine/train/train.py

```diff
@@ -22,14 +22,15 @@
 import os
 from ppcls.utils import logger
 from gaea_operator.metric.types.metric import BaseTrainMetric, TrainMetric
 import fcntl
 
 def train_epoch(engine, epoch_id, print_batch_step):
     tic = time.time()
+    save_loss_interval = min(20, len(engine.train_dataloader))
     for iter_id, batch in enumerate(engine.train_dataloader):
         if iter_id >= engine.max_iter:
             break
         profiler.add_profiler_step(engine.config["profiler_options"])
         if iter_id == 5:
             for key in engine.time_info:
                 engine.time_info[key].reset()
@@ -56,28 +57,28 @@
                 loss_dict = engine.train_loss_func(out, batch[1])
         else:
             out = forward(engine, batch)
             loss_dict = engine.train_loss_func(out, batch[1])
 
         # loss
         loss = loss_dict["loss"] / engine.update_freq
-
-        class_train_metric = TrainMetric(metrics=[])
-        class_train_metric.metrics.append(BaseTrainMetric(name="Loss", result=loss))
-        class_train_metric.step = engine.global_step
-        try:
-            with open(os.path.join(engine.work_dir, f"{engine.run_id}.json"), 'w') as f:
-                try:
-                    fcntl.flock(f, fcntl.LOCK_EX)
-                    json.dump(class_train_metric.dict(), f, indent=2)
-                finally:
-                    fcntl.flock(f, fcntl.LOCK_UN)
-            logger.info("Saving training loss metric to {}".format(os.path.join(engine.work_dir, f"{engine.run_id}.json")))
-        except:
-            logger.error("Failed to save training loss metric to {}".format(os.path.join(engine.work_dir, f"{engine.run_id}.json")))
+        if engine.global_step % save_loss_interval == 0:
+            class_train_metric = TrainMetric(metrics=[])
+            class_train_metric.metrics.append(BaseTrainMetric(name="Loss", result=loss))
+            class_train_metric.step = engine.global_step
+            try:
+                with open(os.path.join(engine.work_dir, f"{engine.run_id}.json"), 'w', encoding='utf-8') as f:
+                    try:
+                        fcntl.flock(f, fcntl.LOCK_EX)
+                        json.dump(class_train_metric.dict(), f, indent=2, ensure_ascii=False)
+                    finally:
+                        fcntl.flock(f, fcntl.LOCK_UN)
+                logger.info("Saving training loss metric to {}".format(os.path.join(engine.work_dir, f"{engine.run_id}.json")))
+            except:
+                logger.error("Failed to save training loss metric to {}".format(os.path.join(engine.work_dir, f"{engine.run_id}.json")))
             
         
         # backward & step opt
         if engine.amp:
             scaled = engine.scaler.scale(loss)
             scaled.backward()
             if (iter_id + 1) % engine.update_freq == 0:
```

## paddleclas/tools/train.py

```diff
@@ -15,14 +15,15 @@
 from __future__ import absolute_import
 from __future__ import division
 from __future__ import print_function
 import os
 import sys
 __dir__ = os.path.dirname(os.path.abspath(__file__))
 sys.path.append(os.path.abspath(os.path.join(__dir__, '../')))
+sys.path.insert(0, os.path.abspath(os.path.join(__dir__, '../')))
 
 from ppcls.utils import config
 from ppcls.engine.engine import Engine
 
 if __name__ == "__main__":
     args = config.parse_args()
     config = config.get_config(
```

## Comparing `gaea_paddleclas-2.5.0.dist-info/LICENSE` & `gaea_paddleclas-2.5.0.1.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `gaea_paddleclas-2.5.0.dist-info/METADATA` & `gaea_paddleclas-2.5.0.1.dist-info/METADATA`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: gaea-paddleclas
-Version: 2.5.0
+Version: 2.5.0.1
 Summary: A treasure chest for visual recognition powered by PaddlePaddle.
 Home-page: https://github.com/PaddlePaddle/PaddleClas
 Download-URL: https://github.com/PaddlePaddle/PaddleClas.git
 License: Apache License 2.0
 Keywords: image-classification,image-recognition,pretrained-models,knowledge-distillation,product-recognition,autoaugment,cutmix,randaugment,gridmask,deit,repvgg,swin-transformer,image-retrieval-system
 Classifier: Development Status :: 5 - Production/Stable
 Classifier: Operating System :: OS Independent
```

## Comparing `gaea_paddleclas-2.5.0.dist-info/RECORD` & `gaea_paddleclas-2.5.0.1.dist-info/RECORD`

 * *Files 1% similar despite different names*

```diff
@@ -1,11 +1,11 @@
 paddleclas/LICENSE,sha256=xx0jnfkXJvxRnG63LTGOxlggYnIysveWIZ6H3PNdCrQ,11357
 paddleclas/MANIFEST.in,sha256=uPxhIK9SAnDc-ljlck8RcqeT3VGP_lnF5hQlZo9-aQc,317
 paddleclas/README.md,sha256=kj4KLq0_a_Db1zPi9IEVdSy65IHrSE447A9V7Kh0J6I,14081
-paddleclas/__init__.py,sha256=0pqPgf5qkL3rjuFeKyd_bKR-QsrBJja9NIl_jP-kn2k,706
+paddleclas/__init__.py,sha256=LyMewW94o1NdoI2HT8Nnh6uFs8JFMBuAhLYvt7UDXzI,808
 paddleclas/hubconf.py,sha256=3Fcg4Y22xbq3eJ-iMWnn3W1RkJXqMuC3QlzT-aOUMt4,28095
 paddleclas/paddleclas.py,sha256=_oYCPQPQlxhazs-YXoi2d3d0S9S-zhmALSsISdqnkeQ,33108
 paddleclas/deploy/configs/inference_attr.yaml,sha256=N1ssqV3yHbBNRm5EeIlejlJZTpEsZPFc3sVVz4UNJJE,756
 paddleclas/deploy/configs/inference_cartoon.yaml,sha256=2V5SX_eB66S2Fp7CT34Wqc-vIITm-BCa2WTR3P14888,1592
 paddleclas/deploy/configs/inference_cls.yaml,sha256=SYh4_46y9ObJUUh04e1HFDnPvSKtUYJg7X7_KoJIUhw,757
 paddleclas/deploy/configs/inference_cls_based_action.yaml,sha256=uE3I5iTtjf030bFd9nybWLjMWe8G02OVSj1PlWfzJrw,749
 paddleclas/deploy/configs/inference_cls_ch4.yaml,sha256=agiHyu1IV8fwoYWXwgWtVzMkX5wrOXKvYjHhJuxxNEo,757
@@ -39,15 +39,15 @@
 paddleclas/deploy/utils/__init__.py,sha256=P7QRc9A4zflovcndLH1FCkjlO6TBmYM7Ssihp4oejIs,122
 paddleclas/deploy/utils/config.py,sha256=glAS0V8Q3OfXK_WXHo3jrAFiFSQ9-pk63ckVFFocmnQ,5865
 paddleclas/deploy/utils/draw_bbox.py,sha256=t-gs88UL2BwI-etwJFbnhM05aGqLpavAXvFAudap0bM,2044
 paddleclas/deploy/utils/encode_decode.py,sha256=PdXTdt-Osls3Y919uIIeeSGebhFlsZqaKFfB18qTC8w,1060
 paddleclas/deploy/utils/get_image_list.py,sha256=HpsbTBkN3KAS6vpF2YM8GqPJBdhVRQetO_gZd7935As,1827
 paddleclas/deploy/utils/logger.py,sha256=gklDK2Re6VkoDo6ygELr_58GrxIrE7wd3HWE3rNRiDI,3587
 paddleclas/deploy/utils/predictor.py,sha256=FNFP8C3x_fucKpT5Gho00Qz7BzNs1zpC07S1Q7XMhnY,4866
-paddleclas/gaea_paddleclas.egg-info/PKG-INFO,sha256=UsxsYlT4ST4BeyzNd30ZmOYo6FCJrOhmkjOIaz0NPBo,14305
+paddleclas/gaea_paddleclas.egg-info/PKG-INFO,sha256=woenRo5-pqMeFl1_dcF3W-LcOlUIbgI0fC1cgiilG0Y,14307
 paddleclas/gaea_paddleclas.egg-info/SOURCES.txt,sha256=2lLRjnS8RT05KA3zr-dlsAWVvK9OHuUNATZo9i8P78I,8798
 paddleclas/gaea_paddleclas.egg-info/dependency_links.txt,sha256=AbpHGcgLb-kRsJGnwFEktk7uzpZOCcBY74-YBdrKVGs,1
 paddleclas/gaea_paddleclas.egg-info/entry_points.txt,sha256=JhO1jR8WbqjSUjhFeVfdl2jeRF6QKJUelBqE0nwWAow,58
 paddleclas/gaea_paddleclas.egg-info/requires.txt,sha256=s0KaRRXOeHL8M_1GxSKu5B02lsmkugwS2RozfU8SumM,137
 paddleclas/gaea_paddleclas.egg-info/top_level.txt,sha256=Cwx8PAiDKO2hLI1tDewVfq8Pm_Jme-MuGSv8f4PRV68,11
 paddleclas/ppcls/__init__.py,sha256=8xIH7bXOpAlHK8bUL61iBE6F4BH66e_xOVmDjiUaf5U,722
 paddleclas/ppcls/arch/__init__.py,sha256=IOldm0g6UB6E57svlt2hZrsc4fCwx5JEtfzUhBILKts,5770
@@ -165,21 +165,21 @@
 paddleclas/ppcls/data/preprocess/ops/operators.py,sha256=cQNYBhldvKsDV1_ppD_TcOhVLlMBGT91IB2SThZVuZ0,25408
 paddleclas/ppcls/data/preprocess/ops/randaugment.py,sha256=uTREuzCCYc3V7VRnLC_Pq-qSA3dDQC-VpKblTBhpzSs,4529
 paddleclas/ppcls/data/preprocess/ops/random_erasing.py,sha256=C5xMn4O-u4YtKcEput7k0V1PBi_RF7Xj80RNYXrHJTE,4070
 paddleclas/ppcls/data/preprocess/ops/timm_autoaugment.py,sha256=BlT6tE28w-lItWvl6iZx2OF-jFLgz1WFmadqJ_WdS4A,31557
 paddleclas/ppcls/data/utils/__init__.py,sha256=nkCgRNhaBKdSrXwRIQWagCmOCoF8Qr0QfNxiUpuP4Qk,609
 paddleclas/ppcls/data/utils/get_image_list.py,sha256=HpsbTBkN3KAS6vpF2YM8GqPJBdhVRQetO_gZd7935As,1827
 paddleclas/ppcls/engine/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
-paddleclas/ppcls/engine/engine.py,sha256=sc31YlizmW8ujhIB9dSNcTxxMeAxbwsWGcGEN3EzEyE,27916
+paddleclas/ppcls/engine/engine.py,sha256=HP-nIGs6KFdMm7U0js8AHigJ3HIpH1RNCyv-7GUiPbw,28887
 paddleclas/ppcls/engine/evaluation/__init__.py,sha256=rpeV1M3_6TwI4mTI78NmoJB5qIzJ_YthlX1DMUw9vf0,799
 paddleclas/ppcls/engine/evaluation/adaface.py,sha256=9OA_WofYs1nvashVoeFx36za9o-oQyAJrsOdTMdIS7c,10431
-paddleclas/ppcls/engine/evaluation/classification.py,sha256=M3fndQ5DH2rnAHUJqCop9MVkMh_Xin8oTp8kZySH9ow,11473
+paddleclas/ppcls/engine/evaluation/classification.py,sha256=fQcp0BIFfzZpCdRe6czxu45DWVtxqHAvIokWb20C4hA,11768
 paddleclas/ppcls/engine/evaluation/retrieval.py,sha256=k9cTzJ8DZp863TIrF4M_I4yQ_FUqgTuPontvzHewIfc,14462
 paddleclas/ppcls/engine/train/__init__.py,sha256=_4MmiTvv_FmCDgYUVmvZmxQ133pL04X7Y9c4tqo-asQ,659
-paddleclas/ppcls/engine/train/train.py,sha256=SQZBphC_Yi8llzC3VJt3fqlV_KHau4nV7BSrYp8en8k,4921
+paddleclas/ppcls/engine/train/train.py,sha256=7wNlQpEQsxxLrLb7M7zDZEUfqe2ArTtsaQ5ofNlvSf0,5130
 paddleclas/ppcls/engine/train/utils.py,sha256=rIh1sxW-dbxpM3svp-fu8xKgMgkoM_FSpkIuP1x0HLU,2986
 paddleclas/ppcls/loss/__init__.py,sha256=ZNU0rlKuk8o80Ete55OUn9r_Lz_ROC8g5osq0TwLtPU,2965
 paddleclas/ppcls/loss/afdloss.py,sha256=5NFUvT9KimAHVK1XvE25RryVAmEwuSwWpjEV9o1ucik,4270
 paddleclas/ppcls/loss/celoss.py,sha256=Xni2A4ekRK-z1ZMeQca39cYLFiP_cFnNPE9i3-_q53s,2213
 paddleclas/ppcls/loss/centerloss.py,sha256=AyGTA-Qk_Gitb4oTS7QR6nPMVETThAzb4S-ea8myBiM,3297
 paddleclas/ppcls/loss/comfunc.py,sha256=jNKB96PouTotVt_UQAFGLjBwouC4bYVp-edI0hPjr-M,1497
 paddleclas/ppcls/loss/deephashloss.py,sha256=DmPCH2MSchBZAIram9r9Q4HMPmNnzfIia12i6be3y0k,5632
@@ -234,14 +234,14 @@
 paddleclas/ppcls/utils/feature_maps_visualization/resnet.py,sha256=VkvEdAb0nlzjXixufnxRFF1wqy52KBXtqdIrDpCm_Sw,19537
 paddleclas/ppcls/utils/feature_maps_visualization/utils.py,sha256=FxBk77orlXvLSLuK1IyfqIOUEEa7SF48Y3rwULFUG5o,2635
 paddleclas/tools/__init__.py,sha256=V9OrlsA8e7i2UFk3V9WzbLCkba4X-bdozFWLItNVkaY,630
 paddleclas/tools/eval.py,sha256=J-auv_ePY-FdM1iXVzEhJriQL5KUsVmXj_iNlIhvHhM,1136
 paddleclas/tools/export_model.py,sha256=grC-WcClgs6Y-HFLd9CnJQmeJLnLc9GK7Xg-QZACxZ0,1602
 paddleclas/tools/infer.py,sha256=YI-pHInFWLZbs-CJ683pHin5sjBtXmzDPuzyyFxzYx0,1138
 paddleclas/tools/search_strategy.py,sha256=bb0yTmxd9eFDWOzugoYdM28QPQGQ-UQ6Y-CqXtJdBOM,5289
-paddleclas/tools/train.py,sha256=2iAY7up5KDkuQxGbuJgciWZQS2fJ3WG196HfKIgmsig,1190
-gaea_paddleclas-2.5.0.dist-info/LICENSE,sha256=xx0jnfkXJvxRnG63LTGOxlggYnIysveWIZ6H3PNdCrQ,11357
-gaea_paddleclas-2.5.0.dist-info/METADATA,sha256=3bGKHihbT2YohCQwJDozvJ2nFaeadhvBYbxmbt8M48M,14320
-gaea_paddleclas-2.5.0.dist-info/WHEEL,sha256=2wepM1nk4DS4eFpYrW1TTqPcoGNfHhhO_i5m4cOimbo,92
-gaea_paddleclas-2.5.0.dist-info/entry_points.txt,sha256=JhO1jR8WbqjSUjhFeVfdl2jeRF6QKJUelBqE0nwWAow,58
-gaea_paddleclas-2.5.0.dist-info/top_level.txt,sha256=Cwx8PAiDKO2hLI1tDewVfq8Pm_Jme-MuGSv8f4PRV68,11
-gaea_paddleclas-2.5.0.dist-info/RECORD,,
+paddleclas/tools/train.py,sha256=Rj7LOUDhO5dK7bSS5jjbkK9VthAXaV4YJPUFJSf5DLE,1256
+gaea_paddleclas-2.5.0.1.dist-info/LICENSE,sha256=xx0jnfkXJvxRnG63LTGOxlggYnIysveWIZ6H3PNdCrQ,11357
+gaea_paddleclas-2.5.0.1.dist-info/METADATA,sha256=26JPT_z8pzW06wA4ueUoJurCvl-U-RucN8bCJil5NBc,14322
+gaea_paddleclas-2.5.0.1.dist-info/WHEEL,sha256=2wepM1nk4DS4eFpYrW1TTqPcoGNfHhhO_i5m4cOimbo,92
+gaea_paddleclas-2.5.0.1.dist-info/entry_points.txt,sha256=JhO1jR8WbqjSUjhFeVfdl2jeRF6QKJUelBqE0nwWAow,58
+gaea_paddleclas-2.5.0.1.dist-info/top_level.txt,sha256=Cwx8PAiDKO2hLI1tDewVfq8Pm_Jme-MuGSv8f4PRV68,11
+gaea_paddleclas-2.5.0.1.dist-info/RECORD,,
```

